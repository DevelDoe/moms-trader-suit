<!-- ./src/renderer/reminder/reminder.html -->

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Reminder</title>
        <link rel="stylesheet" href="../../styles/styles.css" />
        <style>
            body {
                margin: 0px;
                margin-right: 20px;
                padding: 0px;
                background-color: #1c1d23;
                overflow: hidden; /* Prevents scrollbars */
                min-width: 100px;
            }

            #reminder {
                padding: 10px;
                font-size: 14px;
                word-wrap: break-word;
                white-space: normal;
                max-width: 600px; /* Prevent extreme resizing */
                box-sizing: border-box;
                border: 1px solid white;
            }

            .reminder-item {
                margin: 5px 0;
                font-size: 16px;
                font-weight: 100;
                line-height: 1.4;
                word-wrap: break-word;
                white-space: normal; /* Allow proper wrapping */
                display: block;
            }

            .critical {
                color: #f23645;
                font-weight: 600;
            }

            .optional {
                color: #ff9800;
            }

            .reminder {
                color: #089981;
            }
        </style>
    </head>
    <body>
        <div id="reminder" class="dragable"></div>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
    const reminderContainer = document.getElementById("reminder");

    window.electronAPI.onUpdateReminderItems((items) => {
        console.log("📩 Received reminder items:", items);

        if (!items || items.length === 0) {
            console.warn("⚠ No reminder items received!");
            return;
        }

        // **Animate Content In**
        reminderContainer.style.opacity = "0"; // Hide before adding items
        reminderContainer.innerHTML = ""; // Clear previous items

        // **Programmatically Add Items**
        setTimeout(() => {
            items.forEach((item) => {
                if (!item.text.trim()) return;
                const itemElement = document.createElement("div");
                itemElement.className = `reminder-item ${item.type}`;
                itemElement.textContent = item.text;
                reminderContainer.appendChild(itemElement);
            });

            // **Force Layout Update & Size Calculation**
            requestAnimationFrame(() => {
                requestAnimationFrame(() => adjustReminderWindowSize());
                reminderContainer.style.opacity = "1"; // Smooth fade-in effect
            });
        }, 50); // Small delay to ensure content update
    });

    function adjustReminderWindowSize() {
        setTimeout(() => {
            const reminderItems = document.querySelectorAll(".reminder-item");

            if (reminderItems.length === 0) {
                console.warn("⚠ No items found for resizing.");
                return;
            }

            let maxWidth = 0;
            let totalHeight = 0;

            reminderItems.forEach((item) => {
                const rect = item.getBoundingClientRect();
                maxWidth = Math.max(maxWidth, rect.width);
                totalHeight += rect.height + 7; // Add extra padding for wrapped text
            });

            // Fallback values
            maxWidth = maxWidth || 250;
            totalHeight = totalHeight || 50;

            let width = Math.min(Math.max(maxWidth + 40, 250), 600); // Min 250px, Max 600px
            let height = Math.max(totalHeight + 20, 50); // Min 50px height

            width = Math.floor(width);
            height = Math.floor(height);

            console.log(`✔ Resizing Reminder Window: ${width}x${height}`);

            if (isNaN(width) || isNaN(height) || width <= 0 || height <= 0) {
                console.error("❌ Invalid window size detected!", { width, height });
                return;
            }

            try {
                window.electronAPI.resizeWindowToContent(width, height);
            } catch (error) {
                console.error("❌ Error resizing window:", error);
            }
        }, 150); // Delay ensures DOM update before measuring
    }

    window.electronAPI.sendReminderReady();
});

        </script>
    </body>
</html>
